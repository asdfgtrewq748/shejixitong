<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>é’»å­”æ•°æ®ä¸Šä¼ æµ‹è¯•</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 50px auto; padding: 20px; }
    .section { margin: 30px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
    h2 { color: #333; }
    input[type="file"] { margin: 10px 0; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; white-space: pre-wrap; font-family: monospace; max-height: 400px; overflow-y: auto; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { color: #666; font-size: 14px; margin-top: 10px; }
    .coal-select { margin: 15px 0; padding: 10px; background: #fff3cd; border-radius: 4px; }
    .coal-select select { padding: 5px; font-size: 14px; }
  </style>
</head>
<body>
  <h1>é’»å­”æ•°æ®ä¸Šä¼ æµ‹è¯•</h1>
  
  <!-- æ­¥éª¤1: ä¸Šä¼ é‡‡åŒºè¾¹ç•Œ -->
  <div class="section">
    <h2>æ­¥éª¤ 1: ä¸Šä¼ é‡‡åŒºè¾¹ç•Œåæ ‡</h2>
    <input type="file" id="boundaryFile" accept=".csv">
    <button onclick="uploadBoundary()">ä¸Šä¼ è¾¹ç•Œ</button>
    <div class="info">ğŸ“ æ–‡ä»¶æ ¼å¼: æ•ä¸œé‡‡åŒºåæ ‡.csvï¼ˆåŒ…å« x, y åˆ—ï¼‰</div>
    <div id="boundaryResult"></div>
  </div>
  
  <!-- æ­¥éª¤2: ä¸Šä¼ é’»å­”åæ ‡ -->
  <div class="section">
    <h2>æ­¥éª¤ 2: ä¸Šä¼ é’»å­”åæ ‡</h2>
    <input type="file" id="coordinatesFile" accept=".csv">
    <button onclick="uploadCoordinates()">ä¸Šä¼ åæ ‡</button>
    <div class="info">ğŸ“ æ–‡ä»¶æ ¼å¼: æ•ä¸œé’»å­”å¯¹åº”åæ ‡.csvï¼ˆåŒ…å« é’»å­”å, åæ ‡x, åæ ‡yï¼‰</div>
    <div id="coordinatesResult"></div>
  </div>
  
  <!-- æ­¥éª¤3: ä¸Šä¼ é’»å­”åˆ†å±‚æ•°æ® -->
  <div class="section">
    <h2>æ­¥éª¤ 3: ä¸Šä¼ é’»å­”åˆ†å±‚æ•°æ®ï¼ˆCSVæ–‡ä»¶ï¼‰</h2>
    <div class="coal-select">
      <label>ç›®æ ‡ç…¤å±‚ï¼ˆå¯é€‰ï¼Œç•™ç©ºåˆ™è‡ªåŠ¨é€‰æ‹©æœ€åšç…¤å±‚ï¼‰ï¼š</label>
      <input type="text" id="targetCoalSeam" placeholder="å¦‚: 16-3ç…¤" style="width: 200px;">
    </div>
    <input type="file" id="boreholeFiles" accept=".csv" multiple>
    <button onclick="uploadBoreholeData()">ä¸Šä¼ é’»å­”æ•°æ®</button>
    <div class="info">ğŸ“ é€‰æ‹©æ‰€æœ‰é’»å­”CSVæ–‡ä»¶ï¼ˆ50-14.csv, 50-15.csv, ...ï¼‰</div>
    <div id="boreholeResult"></div>
  </div>
  
  <!-- æ­¥éª¤4: åˆå¹¶æ•°æ® -->
  <div class="section">
    <h2>æ­¥éª¤ 4: åˆå¹¶åæ ‡å’Œåˆ†å±‚æ•°æ®</h2>
    <button onclick="mergeData()">åˆå¹¶æ•°æ®</button>
    <div class="info">âš™ï¸ å°†é’»å­”åæ ‡å’Œåˆ†å±‚æ•°æ®åˆå¹¶</div>
    <div id="mergeResult"></div>
  </div>
  
  <!-- æ­¥éª¤5: æŸ¥çœ‹å¯ç”¨ç…¤å±‚ -->
  <div class="section">
    <h2>æ­¥éª¤ 5: æŸ¥çœ‹å¯ç”¨ç…¤å±‚</h2>
    <button onclick="getCoalSeams()">è·å–ç…¤å±‚åˆ—è¡¨</button>
    <div id="coalSeamsResult"></div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3001/api';

    async function uploadBoundary() {
      const fileInput = document.getElementById('boundaryFile');
      const file = fileInput.files[0];
      if (!file) {
        alert('è¯·é€‰æ‹©è¾¹ç•Œæ–‡ä»¶');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch(`${API_BASE}/upload/boundary`, {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        showResult('boundaryResult', result, response.ok);
      } catch (err) {
        showResult('boundaryResult', { error: err.message }, false);
      }
    }

    async function uploadCoordinates() {
      const fileInput = document.getElementById('coordinatesFile');
      const file = fileInput.files[0];
      if (!file) {
        alert('è¯·é€‰æ‹©åæ ‡æ–‡ä»¶');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch(`${API_BASE}/upload/borehole-coordinates`, {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        showResult('coordinatesResult', result, response.ok);
      } catch (err) {
        showResult('coordinatesResult', { error: err.message }, false);
      }
    }

    async function uploadBoreholeData() {
      const fileInput = document.getElementById('boreholeFiles');
      const targetCoalSeam = document.getElementById('targetCoalSeam').value.trim();
      const files = fileInput.files;
      
      if (files.length === 0) {
        alert('è¯·é€‰æ‹©é’»å­”æ–‡ä»¶');
        return;
      }

      const formData = new FormData();
      for (let i = 0; i < files.length; i++) {
        formData.append('files', files[i]);
      }
      
      if (targetCoalSeam) {
        formData.append('targetCoalSeam', targetCoalSeam);
      }

      try {
        showResult('boreholeResult', { message: `æ­£åœ¨ä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶...` }, true);
        
        const response = await fetch(`${API_BASE}/boreholes/batch-upload`, {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        showResult('boreholeResult', result, response.ok);
      } catch (err) {
        showResult('boreholeResult', { error: err.message }, false);
      }
    }

    async function mergeData() {
      try {
        const response = await fetch(`${API_BASE}/boreholes/merge-with-coordinates`, {
          method: 'POST'
        });
        const result = await response.json();
        showResult('mergeResult', result, response.ok);
      } catch (err) {
        showResult('mergeResult', { error: err.message }, false);
      }
    }

    async function getCoalSeams() {
      try {
        const response = await fetch(`${API_BASE}/boreholes/coal-seams`);
        const result = await response.json();
        showResult('coalSeamsResult', result, response.ok);
      } catch (err) {
        showResult('coalSeamsResult', { error: err.message }, false);
      }
    }

    function showResult(elementId, data, success) {
      const resultDiv = document.getElementById(elementId);
      resultDiv.className = 'result ' + (success ? 'success' : 'error');
      resultDiv.textContent = JSON.stringify(data, null, 2);
    }
  </script>
</body>
</html>
