# 智能采掘设计系统 - 启动指南

## 系统架构更新说明
本系统后端已重构为 **Python (FastAPI)** 版本，以支持更强大的几何算法（Shapely）和图论计算（NetworkX）。前端保持为 React (Vite)。

## 环境要求

### 前端环境
- **Node.js**: 18.0 或更高版本
- **npm**: 随 Node.js 安装

### 后端环境
- **Python**: 3.8 或更高版本
- **pip**: Python 包管理工具

检查环境：
```powershell
node -v   # 应显示 v18.x.x 或更高
python --version # 应显示 Python 3.8.x 或更高
```

---

## 一键安装依赖

```powershell
cd e:\xiangmu\shejixitong

# 1. 安装前端依赖
cd frontend
npm install

# 2. 安装后端依赖 (Python)
cd ..\backend_python
pip install -r requirements.txt
```

> 如果 pip 安装速度慢，可使用清华源：
> `pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple`

---

## 启动服务

### 方式一：分开两个终端启动（推荐）

**终端 1 - 启动后端 (端口 3001)**
```powershell
cd e:\xiangmu\shejixitong\backend_python
python main.py
```
*看到 `Uvicorn running on http://0.0.0.0:3001` 即表示启动成功。*

**终端 2 - 启动前端 (端口 5173)**
```powershell
cd e:\xiangmu\shejixitong\frontend
npm run dev
```

### 方式二：一行命令同时启动

```powershell
# 后台启动后端，前台启动前端
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd e:\xiangmu\shejixitong\backend_python; python main.py"
cd e:\xiangmu\shejixitong\frontend; npm run dev
```

---

## 访问地址

| 服务 | 地址 | 说明 |
|------|------|------|
| 前端界面 | http://localhost:5173 | 用户操作界面 |
| 后端 API | http://localhost:3001 | FastAPI 接口服务 |
| API 文档 | http://localhost:3001/docs | Swagger UI 在线文档 |

---

## 新增功能特性

1.  **智能工作面布局**: 基于 Shapely 几何引擎，自动计算最优工作面排列。
2.  **自动巷道生成**: 基于 NetworkX 最小生成树算法，自动规划巷道路径。
3.  **地质建模**: 基于 Scipy 插值算法，生成煤层厚度/瓦斯含量热力图。
4.  **DXF 导出**: 支持将设计方案导出为 CAD 标准格式 (.dxf)。

---

## 常见问题

### 端口被占用

**前端端口冲突**
```powershell
cd e:\xiangmu\shejixitong\frontend
npm run dev -- --port 5174
```

**后端端口冲突**
修改 `backend_python/main.py` 中的端口号：
```python
if __name__ == "__main__":
    uvicorn.run("main:app", host="0.0.0.0", port=3002, reload=True) # 修改 port 参数
```

### 缺少 Python 库
如果启动报错 `ModuleNotFoundError`，请重新运行依赖安装命令：
```powershell
pip install -r requirements.txt
```

### 前端连不上后端
1. 确保后端终端没有报错并保持运行。
2. 检查 `frontend/src/api.js` 中的 `API_BASE` 是否为 `http://localhost:3001/api`。

---

## CSV 数据导入说明

系统支持三种 CSV 文件的批量导入：

### 1. 采区边界 (boundary)
定义采区的多边形边界顶点坐标。

**文件格式:**
```csv
x,y
100,100
700,80
750,500
600,550
200,520
```

**识别方式:** 文件名包含 `边界`、`boundary` 或 `采区`

### 2. 钻孔坐标 (borehole-coordinates)
定义每个钻孔的位置。

**文件格式:**
```csv
id,x,y
ZK-101,150,130
ZK-102,280,210
ZK-103,420,180
```

**支持的列名:** `id/钻孔编号`, `x/坐标X`, `y/坐标Y`

**识别方式:** 文件名包含 `坐标`、`coordinate` 或 `位置`

### 3. 钻孔数据 (borehole-data)
每个钻孔的地质参数。

**文件格式:**
```csv
id,岩石硬度,瓦斯含量,煤层厚度,地下水位
ZK-101,6.5,4.2,3.8,25
ZK-102,7.2,5.8,4.1,32
```

**支持的列名:**
- `id` / `钻孔编号` / `钻孔ID`
- `rockHardness` / `岩石硬度` / `普氏系数`
- `gasContent` / `瓦斯含量` / `瓦斯`
- `coalThickness` / `煤层厚度` / `厚度`
- `groundWater` / `地下水位` / `水位`

**识别方式:** 文件名包含 `数据`、`data` 或 `属性`

### 示例文件

项目 `examples/` 目录下提供了示例 CSV 文件：
- `采区边界.csv` - 边界坐标示例
- `钻孔坐标.csv` - 15 个钻孔位置
- `钻孔数据.csv` - 15 个钻孔的地质参数

### 使用方法

1. 在左侧 Data Sources 区域选择 **文件** 模式
2. 拖拽 CSV 文件到上传区域（支持多选）
3. 系统自动识别文件类型
4. 点击上传按钮
5. 数据导入后自动进入分析页面
