# 智能采掘设计系统 - 启动指南

## 环境要求

- **Node.js**: 18.0 或更高版本
- **npm**: 随 Node.js 安装
- **操作系统**: Windows 10/11

检查环境：
```powershell
node -v   # 应显示 v18.x.x 或更高
npm -v    # 应显示 9.x.x 或更高
```

---

## 一键安装依赖

```powershell
cd e:\xiangmu\shejixitong

# 安装前端依赖
cd frontend
npm install

# 安装后端依赖
cd ..\backend
npm install
```

---

## 启动服务

### 方式一：分开两个终端启动（推荐）

**终端 1 - 启动后端 (端口 3001)**
```powershell
cd e:\xiangmu\shejixitong\backend
npm run dev
```

**终端 2 - 启动前端 (端口 5173)**
```powershell
cd e:\xiangmu\shejixitong\frontend
npm run dev
```

### 方式二：一行命令同时启动

```powershell
# 后台启动后端，前台启动前端
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd e:\xiangmu\shejixitong\backend; npm run dev"
cd e:\xiangmu\shejixitong\frontend; npm run dev
```

---

## 访问地址

| 服务 | 地址 |
|------|------|
| 前端界面 | http://localhost:5173 |
| 后端 API | http://localhost:3001 |
| 健康检查 | http://localhost:3001/api/health |

---

## 停止服务

在对应终端按 `Ctrl + C` 停止服务。

---

## 常见问题

### 端口被占用

**前端端口冲突**
```powershell
cd e:\xiangmu\shejixitong\frontend
npm run dev -- --port 5174
```

**后端端口冲突**
修改 `backend/index.js` 中的端口号：
```javascript
const PORT = 3002;  // 改为其他端口
```

### npm 安装慢

使用国内镜像：
```powershell
npm config set registry https://registry.npmmirror.com
```

### 前端连不上后端

1. 确保后端已启动并显示 `Server running on port 3001`
2. 检查 `frontend/src/api.js` 中的 API 地址配置

---

## 开发模式特性

- **前端热更新**: 修改代码后浏览器自动刷新
- **后端热重载**: 使用 `npm run dev` 启动时，修改代码自动重启

---

## 构建生产版本

```powershell
cd e:\xiangmu\shejixitong\frontend
npm run build
```

构建产物在 `frontend/dist/` 目录，可部署到任意静态服务器。

---

## CSV 数据导入说明

系统支持三种 CSV 文件的批量导入：

### 1. 采区边界 (boundary)
定义采区的多边形边界顶点坐标。

**文件格式:**
```csv
x,y
100,100
700,80
750,500
600,550
200,520
```

**识别方式:** 文件名包含 `边界`、`boundary` 或 `采区`

### 2. 钻孔坐标 (borehole-coordinates)
定义每个钻孔的位置。

**文件格式:**
```csv
id,x,y
ZK-101,150,130
ZK-102,280,210
ZK-103,420,180
```

**支持的列名:** `id/钻孔编号`, `x/坐标X`, `y/坐标Y`

**识别方式:** 文件名包含 `坐标`、`coordinate` 或 `位置`

### 3. 钻孔数据 (borehole-data)
每个钻孔的地质参数。

**文件格式:**
```csv
id,岩石硬度,瓦斯含量,煤层厚度,地下水位
ZK-101,6.5,4.2,3.8,25
ZK-102,7.2,5.8,4.1,32
```

**支持的列名:**
- `id` / `钻孔编号` / `钻孔ID`
- `rockHardness` / `岩石硬度` / `普氏系数`
- `gasContent` / `瓦斯含量` / `瓦斯`
- `coalThickness` / `煤层厚度` / `厚度`
- `groundWater` / `地下水位` / `水位`

**识别方式:** 文件名包含 `数据`、`data` 或 `属性`

### 示例文件

项目 `examples/` 目录下提供了示例 CSV 文件：
- `采区边界.csv` - 边界坐标示例
- `钻孔坐标.csv` - 15 个钻孔位置
- `钻孔数据.csv` - 15 个钻孔的地质参数

### 使用方法

1. 在左侧 Data Sources 区域选择 **文件** 模式
2. 拖拽 CSV 文件到上传区域（支持多选）
3. 系统自动识别文件类型
4. 点击上传按钮
5. 数据导入后自动进入分析页面

---

## 内置示例数据说明

仓库 `input/` 目录下的 CSV 会在后端启动时被自动加载为内置数据（用于快速演示）：

- `input/zuobiao.csv` 或包含“坐标”关键字的 CSV：作为钻孔坐标（`id,x,y`）
- `input/测试钻孔/` 目录：包含多个 `BK-*.csv`，会对每个文件的数值列做简单聚合并作为该钻孔的属性

启动后端时，系统会将这些数据写入内存 `store`：
- `store.boreholes`：合并的钻孔列表（包含 `id,x,y,data`）
- `store.boundary`：基于坐标生成的近似矩形边界（外扩 5% margin）

如果你想使用这些内置数据，请直接启动后端（无需额外上传）。可以通过下列接口检查：

```powershell
# 获取当前内置钻孔
Invoke-RestMethod -Uri http://localhost:3001/api/boreholes -Method GET | ConvertTo-Json -Depth 5

# 获取自动生成的边界
Invoke-RestMethod -Uri http://localhost:3001/api/boundary -Method GET | ConvertTo-Json -Depth 5
```

如果后端未读取到 `input/` 目录或文件名不匹配，则内置加载会被跳过，系统保持空数据状态。
