工作面设计方法的重构计划

当前工作面布置的算法需要推倒重来，重新设计以符合采矿工程实际。下面将详细列出重构步骤和具体任务清单，确保新方法更加合理、符合规程要求，并提供可视化编辑与导出功能。

步骤1：整合地质数据与煤层模型

数据获取：利用已有的地质数据读取和煤层建模库，提取采区范围边界、多边形坐标、煤层厚度、倾角和倾向等关键参数。确保这些数据在设计模块中可以方便调用。

参数准备：从煤层模型中计算采区总体走向和倾角。例如，获取煤层倾角大小及倾向方向，用于后续确定工作面布置朝向。还需要煤层埋深范围、厚度变化等信息，以便影响工作面宽度和煤柱尺寸的计算。

数据验证：在整合后，验证输入数据正确性。比如打印/检查采区边界坐标点、煤层倾角（°）和方向（NESW），煤层平均厚度和深度等，确保这些值符合预期，便于后续计算。

步骤2：确定工作面布置边界

选择布置边界：根据采区边界形状和煤层倾向，选择合适的一侧作为工作面起布置边界。通常工作面应当与采区的大巷垂直，因此选择与主巷道平行的边界作为工作面基线。

依据倾角：如果煤层有明显倾角，优先将工作面布置在采区下倾一侧边界，从而实现仰斜开采（自下向上推进）。仰斜开采可避免设备下滑，并使积水流向采空区，利于安全。若煤层近水平，则可任选一侧作为起始边界，但尽量遵循工程师经验或用户指定。

定义朝向：明确工作面的朝向与推进方向。例如，假设煤层倾向向东，下部边界在东侧，则将工作面沿东侧边界布置，工作面垂直于边界大巷，推进方向朝西上倾。确保每个工作面走向与大巷垂直、工作面之间互相平行。

记录边界：在代码中加入对上述逻辑的实现：根据倾角判断边界。如果需要，可让用户手动选择边界作为参数输入。最后，将选定的边界线起点作为首个工作面的位置基准。

步骤3：计算合理的工作面宽度

确定影响因素：工作面宽度（即长壁工作面的跨度）受煤层厚度、埋深以及设备能力和地质条件影响。厚煤层往往单个工作面产量大，可适当减小宽度；浅埋深或稳固顶板条件下可加大工作面宽度，而深埋煤层或顶板不稳时需减小宽度。

参考规程或经验：查询设计规范或行业经验，获取合理的工作面宽度范围（例如100–300米范围）。结合本矿井条件给出建议值。例如，对于中等厚度（3–5米）、中等埋深（数百米）的煤层，工作面宽度常取150–200米。

公式或计算：如果有成熟公式，可将煤层厚度H、埋深D代入计算推荐宽度。例如某些经验公式：$W = k \times \sqrt{H \times D}$（假设公式），计算出初步宽度。也可采用查表法或通过已有库函数获得建议值。

实现代码：封装一个函数calculateFaceWidth(thickness, depth)，内部根据上述逻辑或参数映射返回工作面宽度。确保函数返回值在合理范围内，且满足覆盖整个煤层的要求（即工作面高度等于煤层厚度）。

验证调整：对不同厚度和埋深测试计算结果，确保宽度值合理。例如，薄煤层或极深部位输出的宽度不要过大。必要时允许用户调整此参数，并在界面上提供该参数的输入或调整选项。

步骤4：计算相邻工作面煤柱宽度

查找规程公式：相邻工作面之间煤柱宽度是重中之重，必须符合安全规程。有严格的计算公式需遵循
ckyckz.kcyjy.com
。查阅**《煤矿安全规程》或《建筑物、水体、铁路及主要井巷煤柱留设与压煤开采规程》**中的相关条款，找到区段煤柱（工作面之间煤柱）的计算方法。通常公式涉及采深H、煤层厚度、顶板岩性及煤的抗压强度等参数，需代入评估最小留设宽度。

实现计算函数：根据规程公式实现煤柱宽度计算函数，例如calculatePillarWidth(depth, height, ... )。代码中代入相应参数计算。如果规程给出多种条件公式（如两侧工作面都采完或只采一侧的情况），取更严格的一种，即更大的宽度保证安全裕度
hanspub.org
。

校核计算：对照规程示例或典型案例验证函数正确性。例如，若采深300米、采高3米，计算得煤柱宽度约为几十米级别，符合常识。若结果偏离常识，检查公式实现。确保煤柱宽度满足不小于规程要求，以保证相邻工作面采动影响下巷道与安全隔离。

参数调整：考虑在界面提供煤柱宽度计算结果展示，并允许根据现场条件调整（但不得小于规范值）。这样既可确保安全又给予工程师一定灵活性。

步骤5：实现工作面与煤柱的布局算法

布置第一个工作面：从步骤2选定的边界开始，在采区内放置矩形工作面。其一边沿着选定边界，长度为计算所得工作面宽度；另一边（推进长度）朝向采区内部，直至到达对侧边界（或留设必要边界煤柱）。记录该工作面的四个角坐标。

迭代铺设后续工作面：在第一个工作面相邻处布置煤柱，然后紧接着煤柱另一侧布置下一个工作面。具体做法是在第一个工作面的起始边界上平移：先沿边界方向从上一个工作面边缘平移出煤柱宽度，再平移出一个工作面宽度的位置，放置第二个工作面矩形。重复此过程依次铺设。

注意每个工作面都与边界大巷垂直，彼此平行。工作面高度方向涵盖整个煤层厚度，不留上下夹矸。

如果最后一个工作面与采区另一端边界之间剩余空间不足一个煤柱宽度，可将剩余部分并入最后一个煤柱或调整最后两个工作面宽度略微扩大以占满采区，但必须保证煤柱不少于最小宽度。

边界条件：确保工作面不超出采区范围。如果采区边界是多边形而非矩形，需要裁剪工作面矩形在边界之外的部分。可采用多边形与矩形相交计算，截取矩形范围内属于采区的区域作为实际工作面。

代码实现：编写layoutWorkfaces(boundary, faceWidth, pillarWidth)函数，实现上述循环。返回一系列工作面多边形的数据结构（每个包含顶点坐标）。同时生成煤柱区域（可表示为矩形带或多边形）的位置数据。注意将这些结果保存到后端数据存储（如store.js）中，以便前端获取并渲染。

验证布局：使用测试边界（例如矩形采区1000m x 500m）和计算的宽度、煤柱，运行函数检查输出工作面数目、位置是否合理。例如，一个500m宽采区，工作面宽度150m、煤柱30m，应铺设约3个工作面+若干煤柱，正好填满边界。不应出现重叠或遗漏。

步骤6：前端可视化集成与调整

绘制设计方案：修改前端画布渲染逻辑，在获取到设计方案数据后，新增绘制工作面和煤柱的功能。使用Canvas在采区范围内绘制矩形工作面轮廓（可用不同颜色填充以区分工作面和煤柱）。例如，工作面用浅色半透明矩形表示，煤柱用深色表示，以便在界面直观区分。

交互控制：确保画布交互（缩放、平移等）对新元素有效。用户应该可以通过已有的交互（如滚轮缩放、拖拽平移）查看整个采区布置。提供图层控制选项，让用户可以开关显示“设计方案”图层，和热力图/等值线等其他分析结果并存。

参数面板：在前端界面增加与工作面设计相关的参数选项，如“工作面宽度”、“煤柱宽度”等。如果这些参数可调，用户调整后可以重新请求后端生成设计方案（POST /api/design 带上新参数）。这样可以交互式地微调方案。

日志与提示：在系统日志或提示区域输出本次设计的关键结果，比如“根据输入计算工作面宽度=150m，煤柱宽度=30m，共划分出3个工作面”。这样工程师对方案心中有数，也便于进一步调整。

步骤7：支持方案编辑与CAD导出

页面直接编辑：为提高灵活性，在可视化画布上实现基本的方案编辑功能。例如，当显示设计方案时，支持用户选中某个工作面矩形并拖动其边缘调整宽度，或拖动整个工作面位置。可以在Canvas上捕获鼠标点击选取多边形，然后提供拖拽手柄。调整后即时更新相邻煤柱位置。如果直接拖拽实现复杂，可退而求其次，通过参数输入调整：用户修改数值后重新生成方案。

方案导出：集成CAD导出功能，将设计结果输出为常用CAD格式（如DXF）。在后端实现导出接口，遍历工作面和巷道的坐标数据，按DXF格式生成实体（如LINE或POLYLINE）。提供前端按钮“导出CAD”，调用后端生成DXF文件并提供下载。这样工程师可以将方案导入AutoCAD等软件继续细化设计。

实现细节：可利用第三方库简化DXF生成，或手动拼接DXF文本。确保导出的单位和坐标与实际尺度一致（例如以米为单位）。导出内容包括采区边界、每个工作面的矩形轮廓线、煤柱区域矩形、以及可能的巷道中心线等。

验证导出：对导出的DXF在AutoCAD中打开检查，确认几何关系正确无误，图层或颜色区分符合预期。特别注意工作面和煤柱是否清晰标识，便于后续编辑。

步骤8：测试验证与后续优化

功能测试：用真实或模拟的数据反复测试新方案生成。验证当煤层条件变化时（厚度递增、倾角改变、小采区范围等），算法仍能正确划分工作面和煤柱，没有出现异常（如零宽度、负空间或遗漏）。对极端情况（采区宽度小于一个工作面宽度+煤柱等）也要有处理（例如只布置一个工作面或给出提示）。

正确性评审：与有经验的采矿工程师或根据规范对比检查方案正确性。确保工作面数目、尺寸、煤柱宽度均符合规程和安全要求。例如，随机抽取某工作面间煤柱距离，核对是否>=公式计算值。根据反馈调整算法细节。

代码优化：在确保功能正确后，对代码进行重构和优化。整理计算过程，将倾角判断、宽度计算、布局生成等封装为独立模块，提高代码可读性和可维护性。优化性能，例如当钻孔数据量大、采区范围广时，算法效率和前端渲染性能是否需要改进。

文档与维护：更新项目文档（如README），说明新的工作面设计逻辑、参数含义和使用方法。记录任何假设和公式来源，方便团队其他成员了解。最后，计划后续功能，如引入更高级的算法（例如针对复杂边界的工作面自适应布置）或将本方案与其它模块（通风、运输）联动，逐步提高系统智能化水平。

通过以上详尽步骤实施，新的工作面设计方法将更加贴近实际需求：仅关注必要的参数（宽度、煤柱），自动遵循矿业规程计算关键尺寸，并提供交互式调整和导出功能。这将大幅提升采区设计的准确性和效率，为矿山工程设计提供有力支持。