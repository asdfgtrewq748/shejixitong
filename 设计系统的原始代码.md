import React, { useState, useEffect, useRef, useMemo } from 'react';
import { 
  Layers, Upload, Database, Activity, ShieldCheck, DollarSign, Leaf, Cpu, 
  Map as MapIcon, Settings, ChevronRight, Play, Save, FileText, 
  Zap, Search, AlertCircle, CheckCircle, Crosshair, BarChart3, Wind, Droplets, Hammer,
  Maximize2, Minimize2, Grid
} from 'lucide-react';

// --- 全局样式注入 (动画关键帧与滚动条) ---
const GlobalStyles = () => (
  <style>{`
    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100%); }
    }
    @keyframes grid-move {
      0% { background-position: 0 0; }
      100% { background-position: 50px 50px; }
    }
    .bg-cyber-grid {
      background-image: linear-gradient(rgba(30, 58, 138, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(30, 58, 138, 0.1) 1px, transparent 1px);
      background-size: 30px 30px;
    }
    .glass-panel {
      background: rgba(17, 24, 39, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }
    .neon-border {
      box-shadow: 0 0 5px rgba(59, 130, 246, 0.5), inset 0 0 10px rgba(59, 130, 246, 0.1);
    }
    /* 自定义滚动条 */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
  `}</style>
);

// --- 模拟数据生成 ---
const MINING_BOUNDARY = [
  { x: 100, y: 100 }, { x: 700, y: 80 }, { x: 750, y: 500 },
  { x: 600, y: 550 }, { x: 200, y: 520 }, { x: 100, y: 100 },
];

const generateBoreholes = (count) => {
  return Array.from({ length: count }, (_, i) => ({
    id: `ZK-${100 + i}`,
    x: 150 + Math.random() * 500,
    y: 120 + Math.random() * 350,
    rockHardness: 4 + Math.random() * 6,
    gasContent: Math.random() * 10,
    coalThickness: 2 + Math.random() * 5,
    groundWater: Math.random() * 100,
    scores: { safety: 0, economic: 0, env: 0 }
  }));
};

const calculateScores = (boreholes) => {
  return boreholes.map(hole => {
    const safetyScore = Math.max(0, 100 - (hole.gasContent * 8) - (Math.abs(hole.rockHardness - 7) * 5));
    const economicScore = Math.min(100, hole.coalThickness * 15 + 20);
    const envScore = Math.max(0, 100 - (hole.groundWater * 0.8));
    return {
      ...hole,
      scores: {
        safety: Math.round(safetyScore),
        economic: Math.round(economicScore),
        env: Math.round(envScore)
      }
    };
  });
};

const MiningDesignSystem = () => {
  // --- 状态管理 ---
  const canvasRef = useRef(null);
  const [activeTab, setActiveTab] = useState('import');
  const [isLoading, setIsLoading] = useState(false);
  const [systemLog, setSystemLog] = useState([]);
  const [boundary, setBoundary] = useState([]);
  const [boreholes, setBoreholes] = useState([]);
  const [weights, setWeights] = useState({ safety: 40, economic: 30, env: 30 });
  const requestRef = useRef(); // 用于动画循环
  const frameRef = useRef(0);  // 帧计数器

  // 日志功能
  const addLog = (msg, type = 'info') => {
    const time = new Date().toLocaleTimeString();
    setSystemLog(prev => [`[${time}] ${msg}|${type}`, ...prev].slice(0, 50));
  };

  // 1. 导入边界
  const handleImportBoundary = () => {
    setIsLoading(true);
    addLog("正在解析 DXF 矢量数据...", 'loading');
    setTimeout(() => {
      setBoundary(MINING_BOUNDARY);
      addLog("采区边界模型构建完成 [顶点: 6]", 'success');
      setIsLoading(false);
    }, 800);
  };

  // 2. 导入钻孔
  const handleImportBoreholes = () => {
    if (boundary.length === 0) return;
    setIsLoading(true);
    addLog("正在连接地质数据库 GeoDB_v4...", 'loading');
    setTimeout(() => {
      let rawData = generateBoreholes(30);
      addLog(`检索到 ${rawData.length} 个钻孔样本`, 'info');
      addLog("正在执行多维评分算法...", 'loading');
      const scoredData = calculateScores(rawData);
      setBoreholes(scoredData);
      addLog("地质数据评分矩阵计算完毕", 'success');
      setIsLoading(false);
      setActiveTab('analysis');
    }, 1200);
  };

  // 3. 设计生成
  const handleGenerateDesign = () => {
    setIsLoading(true);
    addLog("启动深度学习推理引擎 (ResNet-Geology)...", 'warning');
    setTimeout(() => addLog("生成全区地质评分网格...", 'info'), 800);
    setTimeout(() => addLog("运行遗传算法优化巷道路径...", 'info'), 1600);
    setTimeout(() => {
      addLog("最优采掘工程设计方案已生成", 'success');
      setActiveTab('synthesis');
      setIsLoading(false);
    }, 2500);
  };

  // --- 动画渲染循环 ---
  const animate = () => {
    if (!canvasRef.current) return;
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    
    frameRef.current += 1; // 增加帧数
    const time = frameRef.current; 

    // 清空画布
    ctx.clearRect(0, 0, width, height);

    // 1. 绘制科技感网格背景 (Canvas 内部)
    ctx.strokeStyle = 'rgba(30, 58, 138, 0.15)';
    ctx.lineWidth = 1;
    const gridSize = 40;
    const offset = (time * 0.5) % gridSize; // 缓慢滚动的网格效果
    
    // 垂直线
    for (let x = 0; x <= width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, height);
        ctx.stroke();
    }
    // 水平线 (带滚动)
    for (let y = -gridSize; y <= height; y += gridSize) {
        let drawY = y + offset;
        if(drawY > height) continue;
        ctx.beginPath();
        ctx.moveTo(0, drawY);
        ctx.lineTo(width, drawY);
        ctx.stroke();
    }

    if (boundary.length === 0) {
        requestRef.current = requestAnimationFrame(animate);
        return;
    }

    // 2. 裁剪区域 (Clip)
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(boundary[0].x, boundary[0].y);
    boundary.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.closePath();
    ctx.clip(); // --- 设置裁剪区 ---

    // 3. 绘制热力图 (带微动态)
    if (boreholes.length > 0) {
      const totalWeight = weights.safety + weights.economic + weights.env;
      
      boreholes.forEach((hole, idx) => {
        const weightedScore = (
          hole.scores.safety * weights.safety +
          hole.scores.economic * weights.economic +
          hole.scores.env * weights.env
        ) / (totalWeight || 1);

        const pulseScale = 1 + Math.sin(time * 0.05 + idx) * 0.05; // 呼吸效果
        const radius = 120 * pulseScale; 

        const grad = ctx.createRadialGradient(hole.x, hole.y, 0, hole.x, hole.y, radius);
        
        let colorMain = weightedScore > 80 ? "16, 185, 129" : weightedScore > 50 ? "245, 158, 11" : "239, 68, 68";
        grad.addColorStop(0, `rgba(${colorMain}, 0.5)`);
        grad.addColorStop(1, "rgba(0,0,0,0)");

        ctx.globalCompositeOperation = 'screen';
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(hole.x, hole.y, radius, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    // 4. 合成设计 (流光路径)
    if (activeTab === 'synthesis' && boreholes.length > 0) {
       ctx.globalCompositeOperation = 'source-over';
       
       // 模拟巷道 - 流光效果
       const pathY = 300 + (weights.safety > 50 ? -50 : 50);
       
       // 基础虚线
       ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
       ctx.lineWidth = 4;
       ctx.setLineDash([15, 10]);
       ctx.beginPath();
       ctx.moveTo(boundary[0].x + 50, pathY);
       ctx.lineTo(boundary[2].x - 50, pathY - 20);
       ctx.stroke();

       // 流动的光点
       ctx.setLineDash([]);
       const pathLength = 500; // approximate
       const flowOffset = (time * 3) % pathLength;
       // 这里简单模拟一个在路径上跑的点，实际需根据路径方程计算
       // 简化：只画一条带偏移 dash 的亮线模拟流动
       ctx.strokeStyle = '#00ffff';
       ctx.lineWidth = 2;
       ctx.lineDashOffset = -time * 2;
       ctx.setLineDash([20, 30]);
       ctx.beginPath();
       ctx.moveTo(boundary[0].x + 50, pathY);
       ctx.lineTo(boundary[2].x - 50, pathY - 20);
       ctx.stroke();
       ctx.setLineDash([]); // 重置

       // 绘制工作面 (带辉光)
       ctx.shadowBlur = 15;
       ctx.shadowColor = '#00ffff';
       ctx.strokeStyle = '#00ffff';
       ctx.fillStyle = 'rgba(0, 255, 255, 0.1)';
       ctx.lineWidth = 2;
       
       const rectX = 300;
       const rectY = pathY - 40;
       ctx.fillRect(rectX, rectY, 150, 80);
       ctx.strokeRect(rectX, rectY, 150, 80);
       
       // 机器扫描线动画
       const scanY = rectY + (time % 80);
       ctx.beginPath();
       ctx.moveTo(rectX, scanY);
       ctx.lineTo(rectX + 150, scanY);
       ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
       ctx.stroke();

       ctx.shadowBlur = 0;
       
       // 标注
       ctx.fillStyle = '#fff';
       ctx.font = 'bold 14px "Courier New"';
       ctx.fillText("OPTIMAL_FACE_01", 310, pathY - 50);
    }

    ctx.restore(); // --- 结束裁剪 ---

    // 5. 绘制边界线 (发光)
    ctx.shadowBlur = 10;
    ctx.shadowColor = '#0ea5e9';
    ctx.strokeStyle = '#0ea5e9';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(boundary[0].x, boundary[0].y);
    boundary.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.closePath();
    ctx.stroke();
    ctx.shadowBlur = 0;

    // 6. 绘制钻孔点 (UI 覆盖层，不被裁剪影响，或者在裁剪内看需求)
    // 通常钻孔应该在裁剪内，但为了看清楚点，这里我们再画一次点
    if (boreholes.length > 0) {
      boreholes.forEach((hole, idx) => {
        // 只有在分析模式下才高亮显示点
        const isActive = activeTab === 'analysis';
        
        ctx.fillStyle = isActive ? '#fff' : 'rgba(255,255,255,0.5)';
        ctx.beginPath();
        // 闪烁点
        const r = isActive ? 3 + Math.sin(time * 0.1 + idx) : 2;
        ctx.arc(hole.x, hole.y, r, 0, Math.PI * 2);
        ctx.fill();

        // 选中状态或高亮时的十字准星
        if (isActive && Math.random() > 0.995) {
            ctx.strokeStyle = 'rgba(255,255,255,0.8)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(hole.x - 5, hole.y); ctx.lineTo(hole.x + 5, hole.y);
            ctx.moveTo(hole.x, hole.y - 5); ctx.lineTo(hole.x, hole.y + 5);
            ctx.stroke();
        }
      });
    }

    // 7. 扫描线雷达 (Radar Scan) - 全局覆盖
    if (isLoading || activeTab === 'analysis') {
        const scanX = (time * 4) % width;
        const gradient = ctx.createLinearGradient(scanX, 0, scanX - 100, 0);
        gradient.addColorStop(0, 'rgba(14, 165, 233, 0.3)');
        gradient.addColorStop(1, 'rgba(14, 165, 233, 0)');
        
        ctx.fillStyle = gradient;
        ctx.fillRect(scanX - 100, 0, 100, height);
        
        ctx.strokeStyle = 'rgba(14, 165, 233, 0.8)';
        ctx.beginPath();
        ctx.moveTo(scanX, 0);
        ctx.lineTo(scanX, height);
        ctx.stroke();
    }

    requestRef.current = requestAnimationFrame(animate);
  };

  useEffect(() => {
    requestRef.current = requestAnimationFrame(animate);
    return () => cancelAnimationFrame(requestRef.current);
  }, [boundary, boreholes, weights, activeTab, isLoading]);


  return (
    <div className="flex flex-col h-screen bg-gray-950 text-gray-100 font-sans overflow-hidden bg-cyber-grid selection:bg-blue-500/30">
      <GlobalStyles />
      
      {/* 顶部导航 */}
      <header className="glass-panel z-50 flex items-center justify-between px-6 py-3 mx-4 mt-4 rounded-xl">
        <div className="flex items-center gap-4">
          <div className="relative group">
            <div className="absolute -inset-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg blur opacity-40 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"></div>
            <div className="relative p-2 bg-gray-900 rounded-lg border border-gray-700">
              <Cpu className="w-6 h-6 text-blue-400 animate-pulse" />
            </div>
          </div>
          <div>
            <h1 className="text-2xl font-black tracking-widest text-white uppercase" style={{ textShadow: '0 0 10px rgba(59, 130, 246, 0.5)' }}>
              GeoMind <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">NEXUS</span>
            </h1>
            <div className="flex items-center gap-2 text-[10px] text-gray-400 tracking-wider">
              <span className="w-2 h-2 bg-green-500 rounded-full animate-ping"></span>
              SYSTEM ONLINE // V5.0.1
            </div>
          </div>
        </div>
        
        {/* 步骤条 */}
        <div className="flex bg-gray-900/50 p-1 rounded-full border border-gray-700 backdrop-blur-sm">
            {['import', 'analysis', 'synthesis'].map((step, idx) => {
                const isActive = activeTab === step;
                const labels = { import: '数据源', analysis: '地质算力', synthesis: '工程决策' };
                const icons = { import: Upload, analysis: Activity, synthesis: MapIcon };
                const Icon = icons[step];
                
                return (
                    <button 
                        key={step}
                        onClick={() => !isLoading && setActiveTab(step)}
                        className={`
                            relative flex items-center gap-2 px-6 py-2 rounded-full text-xs font-bold transition-all duration-300
                            ${isActive ? 'text-white bg-blue-600 shadow-[0_0_15px_rgba(37,99,235,0.5)]' : 'text-gray-500 hover:text-gray-300'}
                        `}
                    >
                        <Icon size={14} />
                        {labels[step]}
                    </button>
                );
            })}
        </div>

        <div className="flex gap-3">
            <button className="p-2.5 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors border border-transparent hover:border-gray-600">
                <Settings size={18} />
            </button>
            <button className="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white text-xs font-bold uppercase tracking-wider rounded-lg shadow-lg shadow-emerald-900/20 border border-emerald-400/20 transition-all hover:scale-105">
                <Save size={14} /> Report
            </button>
        </div>
      </header>

      {/* 主体内容 */}
      <main className="flex flex-1 overflow-hidden p-4 gap-4">
        
        {/* 左侧控制面板 */}
        <aside className="w-80 glass-panel rounded-xl flex flex-col overflow-hidden animate-[slideInLeft_0.5s_ease-out]">
            <div className="p-5 space-y-8 overflow-y-auto">
                
                {/* 模块1：数据源 */}
                <div className="space-y-4">
                    <h3 className="text-xs uppercase tracking-[0.2em] text-blue-400 font-bold flex items-center gap-2 pb-2 border-b border-gray-700/50">
                        <Database size={12} /> Data Sources
                    </h3>
                    
                    <div className="space-y-3">
                        <button 
                            onClick={handleImportBoundary}
                            className={`group w-full relative overflow-hidden p-4 rounded-xl border transition-all duration-300 text-left
                                ${boundary.length > 0 
                                    ? 'bg-blue-900/20 border-blue-500/50 text-blue-300' 
                                    : 'bg-gray-800/40 border-gray-700 text-gray-400 hover:border-gray-500 hover:bg-gray-800'}
                            `}
                        >
                             <div className={`absolute inset-0 bg-blue-400/10 translate-y-full transition-transform duration-300 ${boundary.length > 0 ? '' : 'group-hover:translate-y-0'}`}></div>
                             <div className="flex justify-between items-center relative z-10">
                                <div>
                                    <span className="block text-sm font-bold">采区边界矢量</span>
                                    <span className="text-[10px] opacity-70">DXF / GIS Vector Format</span>
                                </div>
                                {boundary.length > 0 ? <CheckCircle className="text-blue-400" size={18} /> : <Upload size={18} />}
                             </div>
                        </button>
                        
                        <button 
                            onClick={handleImportBoreholes}
                            disabled={boundary.length === 0}
                            className={`group w-full relative overflow-hidden p-4 rounded-xl border transition-all duration-300 text-left
                                ${boreholes.length > 0 
                                    ? 'bg-amber-900/20 border-amber-500/50 text-amber-300' 
                                    : 'bg-gray-800/40 border-gray-700 text-gray-400 hover:border-gray-500 hover:bg-gray-800'}
                                ${boundary.length === 0 ? 'opacity-40 cursor-not-allowed' : ''}
                            `}
                        >
                             <div className={`absolute inset-0 bg-amber-400/10 translate-y-full transition-transform duration-300 ${boreholes.length > 0 ? '' : 'group-hover:translate-y-0'}`}></div>
                             <div className="flex justify-between items-center relative z-10">
                                <div>
                                    <span className="block text-sm font-bold">钻孔地质库</span>
                                    <span className="text-[10px] opacity-70">CSV / SQL Database</span>
                                </div>
                                {boreholes.length > 0 ? <CheckCircle className="text-amber-400" size={18} /> : <Database size={18} />}
                             </div>
                        </button>
                    </div>
                </div>

                {/* 模块2：权重 */}
                <div className="space-y-6">
                    <h3 className="text-xs uppercase tracking-[0.2em] text-purple-400 font-bold flex items-center gap-2 pb-2 border-b border-gray-700/50">
                        <Settings size={12} /> Parameters
                    </h3>

                    {[
                        { key: 'safety', label: 'Safety Factor', icon: ShieldCheck, color: 'text-blue-400', accent: 'accent-blue-500', bg: 'bg-blue-500' },
                        { key: 'economic', label: 'Economic Value', icon: DollarSign, color: 'text-amber-400', accent: 'accent-amber-500', bg: 'bg-amber-500' },
                        { key: 'env', label: 'Eco-Friendly', icon: Leaf, color: 'text-emerald-400', accent: 'accent-emerald-500', bg: 'bg-emerald-500' },
                    ].map(item => (
                        <div key={item.key} className="space-y-3 group">
                            <div className="flex justify-between text-sm items-center">
                                <span className={`flex items-center gap-2 ${item.color} font-medium`}>
                                    <item.icon size={14}/> {item.label}
                                </span>
                                <span className={`font-mono ${item.color} bg-gray-800 px-2 py-0.5 rounded text-xs`}>
                                    {weights[item.key]}%
                                </span>
                            </div>
                            <div className="relative h-1.5 bg-gray-700 rounded-full overflow-hidden">
                                <div 
                                    className={`absolute top-0 left-0 h-full ${item.bg} transition-all duration-300`} 
                                    style={{ width: `${weights[item.key]}%` }}
                                ></div>
                                <input 
                                    type="range" min="0" max="100" 
                                    value={weights[item.key]}
                                    onChange={(e) => setWeights({...weights, [item.key]: parseInt(e.target.value)})}
                                    className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                />
                            </div>
                        </div>
                    ))}
                </div>

                {/* 模块3：操作 */}
                <div className="mt-auto">
                     <button 
                        onClick={handleGenerateDesign}
                        disabled={boreholes.length === 0 || isLoading}
                        className={`
                            relative w-full py-5 rounded-xl flex items-center justify-center gap-3 font-bold text-sm tracking-wider uppercase transition-all overflow-hidden group
                            ${boreholes.length > 0 
                                ? 'text-white shadow-[0_0_20px_rgba(59,130,246,0.4)] hover:shadow-[0_0_30px_rgba(59,130,246,0.6)]' 
                                : 'bg-gray-800/50 text-gray-500 cursor-not-allowed border border-gray-700'}
                        `}
                    >
                        {boreholes.length > 0 && (
                            <div className="absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 transition-transform duration-300 group-hover:scale-105"></div>
                        )}
                        {boreholes.length > 0 && (
                             <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>
                        )}
                        
                        <div className="relative z-10 flex items-center gap-2">
                            {isLoading ? <Activity className="animate-spin" /> : <Play fill="currentColor" size={16} />}
                            {isLoading ? 'PROCESSING...' : 'GENERATE OPTIMAL DESIGN'}
                        </div>
                    </button>
                </div>
            </div>
        </aside>

        {/* 中间可视化区 */}
        <section className="flex-1 relative flex flex-col rounded-xl overflow-hidden glass-panel border-gray-700/50 shadow-2xl">
            
            {/* 画布头部状态栏 */}
            <div className="absolute top-0 left-0 right-0 h-12 bg-gradient-to-b from-gray-900/90 to-transparent z-10 flex items-center justify-between px-4 pointer-events-none">
                <div className="flex gap-4 text-[10px] text-gray-400 font-mono">
                    <span className="flex items-center gap-1"><Crosshair size={10} /> COORDS: 482, 192</span>
                    <span className="flex items-center gap-1"><Maximize2 size={10} /> SCALE: 1:2000</span>
                </div>
                <div className="flex gap-2">
                     <div className="bg-black/40 backdrop-blur rounded px-2 py-1 border border-gray-700/50 flex items-center gap-2 text-[10px] text-gray-300">
                        <span className="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_5px_rgba(16,185,129,0.8)]"></span> HIGH SUITABILITY
                     </div>
                     <div className="bg-black/40 backdrop-blur rounded px-2 py-1 border border-gray-700/50 flex items-center gap-2 text-[10px] text-gray-300">
                        <span className="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_5px_rgba(239,68,68,0.8)]"></span> HAZARD ZONE
                     </div>
                </div>
            </div>

            {/* Canvas 容器 */}
            <div className="relative flex-1 bg-gray-900 flex items-center justify-center overflow-hidden">
                {/* 装饰性网格线 */}
                <div className="absolute inset-0 pointer-events-none opacity-20" 
                    style={{ backgroundImage: 'linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px)', backgroundSize: '100px 100px' }}>
                </div>

                <canvas 
                    ref={canvasRef}
                    width={900}
                    height={700}
                    className="cursor-crosshair w-full h-full object-contain"
                />
                
                {/* 加载中全屏覆盖 */}
                {isLoading && (
                    <div className="absolute inset-0 bg-gray-900/80 backdrop-blur-sm flex flex-col items-center justify-center z-30">
                        <div className="relative w-24 h-24 mb-6">
                            <div className="absolute inset-0 rounded-full border-t-2 border-b-2 border-blue-500 animate-spin"></div>
                            <div className="absolute inset-2 rounded-full border-r-2 border-l-2 border-purple-500 animate-spin reverse duration-700"></div>
                            <div className="absolute inset-0 flex items-center justify-center">
                                <Cpu className="text-blue-400 animate-pulse" size={32} />
                            </div>
                        </div>
                        <h2 className="text-2xl font-black text-white tracking-widest mb-1">COMPUTING</h2>
                        <div className="flex items-center gap-1 text-blue-400 font-mono text-sm">
                            <span>[</span>
                            <span className="w-20 h-2 bg-gray-800 rounded-full overflow-hidden relative">
                                <span className="absolute inset-0 bg-blue-500 animate-[scanline_1s_infinite]"></span>
                            </span>
                            <span>]</span>
                        </div>
                    </div>
                )}

                {/* 空状态提示 */}
                {boundary.length === 0 && !isLoading && (
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div className="text-center group">
                            <div className="w-20 h-20 mx-auto mb-6 rounded-full border-2 border-dashed border-gray-700 flex items-center justify-center group-hover:border-blue-500/50 group-hover:scale-110 transition-all duration-500">
                                <Layers size={32} className="text-gray-600 group-hover:text-blue-400 transition-colors" />
                            </div>
                            <h3 className="text-xl font-bold text-gray-300 tracking-wide">NO DATA LOADED</h3>
                            <p className="text-gray-500 text-sm mt-2 font-mono">Initiate sequence via [Data Sources]</p>
                        </div>
                    </div>
                )}
            </div>
            
            {/* Canvas 底部工具栏 */}
            <div className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-gray-900/80 backdrop-blur border border-gray-700 rounded-full px-4 py-2 flex gap-4 z-20 shadow-xl">
                 <button className="text-gray-400 hover:text-white transition-colors"><Grid size={18}/></button>
                 <button className="text-gray-400 hover:text-white transition-colors"><Search size={18}/></button>
                 <div className="w-px h-6 bg-gray-700"></div>
                 <button className="text-gray-400 hover:text-white transition-colors"><Minimize2 size={18}/></button>
                 <button className="text-gray-400 hover:text-white transition-colors"><Maximize2 size={18}/></button>
            </div>

        </section>

        {/* 右侧：日志与详情 */}
        <aside className="w-72 glass-panel rounded-xl flex flex-col overflow-hidden animate-[slideInRight_0.5s_ease-out]">
            <div className="p-4 border-b border-gray-700/50 bg-gray-900/30">
                <h3 className="text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2">
                    <FileText size={12}/> System Terminal
                </h3>
            </div>
            
            <div className="flex-1 overflow-y-auto p-4 space-y-1 font-mono text-[10px] scroll-smooth">
                {systemLog.length === 0 && <span className="text-gray-600 animate-pulse">_ Waiting for input...</span>}
                {systemLog.map((log, index) => {
                    const [text, type] = log.split('|');
                    const colors = { 
                        info: 'text-gray-300 border-gray-600', 
                        success: 'text-green-400 border-green-600', 
                        warning: 'text-amber-400 border-amber-600',
                        loading: 'text-blue-300 border-blue-600'
                    };
                    return (
                        <div key={index} className={`border-l-2 pl-2 py-1 mb-1 animate-[fadeIn_0.2s_ease-out] ${colors[type] || colors.info}`}>
                            <span className="opacity-50 mr-2">{text.match(/^\[(.*?)\]/)[0]}</span>
                            <span>{text.replace(/^\[.*?\]\s/, '')}</span>
                        </div>
                    );
                })}
            </div>

            {/* 结果面板 */}
            {activeTab === 'synthesis' && (
                <div className="border-t border-gray-700/50 bg-gradient-to-t from-blue-900/20 to-transparent p-5">
                    <h4 className="text-xs font-bold text-white uppercase tracking-wider mb-4 flex items-center gap-2">
                        <BarChart3 size={14} className="text-blue-400"/> Projected Metrics
                    </h4>
                    <div className="grid grid-cols-2 gap-3">
                        <div className="bg-gray-800/50 p-3 rounded-lg border border-gray-700 hover:border-blue-500/50 transition-colors group">
                            <div className="text-[10px] text-gray-400 uppercase mb-1">Total Score</div>
                            <div className="text-2xl font-black text-white group-hover:text-blue-400 transition-colors">94.8</div>
                        </div>
                        <div className="bg-gray-800/50 p-3 rounded-lg border border-gray-700 hover:border-amber-500/50 transition-colors group">
                            <div className="text-[10px] text-gray-400 uppercase mb-1 flex items-center gap-1"><Hammer size={10}/> Output</div>
                            <div className="text-xl font-bold text-white group-hover:text-amber-400 transition-colors">240<span className="text-xs ml-0.5 opacity-50">Mt</span></div>
                        </div>
                        <div className="bg-gray-800/50 p-3 rounded-lg border border-gray-700 hover:border-emerald-500/50 transition-colors group">
                            <div className="text-[10px] text-gray-400 uppercase mb-1 flex items-center gap-1"><ShieldCheck size={10}/> Rating</div>
                            <div className="text-xl font-bold text-emerald-400">A++</div>
                        </div>
                        <div className="bg-gray-800/50 p-3 rounded-lg border border-gray-700 hover:border-purple-500/50 transition-colors group">
                            <div className="text-[10px] text-gray-400 uppercase mb-1 flex items-center gap-1"><Wind size={10}/> Vent</div>
                            <div className="text-xl font-bold text-gray-200 group-hover:text-purple-400">Low</div>
                        </div>
                    </div>
                </div>
            )}
        </aside>
      </main>
    </div>
  );
};

export default MiningDesignSystem;